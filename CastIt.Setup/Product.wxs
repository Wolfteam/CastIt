<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <!--Do not modify this upgrade code-->
  <?define ProductUpgradeCode = "{DD46D441-3F63-416F-A2A2-9785B668C4E0}" ?>

  <Product
      Id="*"
      Name="!(loc.ProductName_$(var.Platform))"
      Language="1033"
      Version="$(var.InstallerVersion)"
      Manufacturer="!(loc.Company)"
      UpgradeCode="$(var.ProductUpgradeCode)">

    <Package
      InstallerVersion="200"
      Compressed="yes"
      InstallScope="perMachine"
      Platform="$(var.Platform)"
      Manufacturer="!(loc.Company)"
      Description="!(loc.Description)"
      Comments="!(loc.Comments)"
      Keywords="!(loc.Keywords)"
      Languages="!(loc.Languages)"/>

    <Icon Id="icon.ico" SourceFile="../CastIt/favicon.ico"/>
    <Property Id="ARPPRODUCTICON">icon.ico</Property>
    <Property Id="ARPURLINFOABOUT">https://github.com/Wolfteam/CastIt</Property>

    <!--Launch after install-->
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="!(loc.Launch)" />
    <Property Id="WixShellExecTarget" Value="[DesktopInstallFolder]CastIt.exe" />
    <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />

    <!--Custom actions-->
    <Binary Id="CustomActionBinary" SourceFile="../CastIt.Setup.CustomActions/bin/$(var.Platform)/$(var.Configuration)/CastIt.Setup.CustomActions.CA.dll"/>
    <CustomAction Id="DeleteUserData" BinaryKey="CustomActionBinary" DllEntry="DeleteUserData"/>

    <UI>
      <UIRef Id="WixUI_Minimal" />
      <!--This publish is required to make the 'launch after install' work-->
      <Publish Dialog="ExitDialog"
               Control="Finish"
               Event="DoAction"
               Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
    </UI>
    <MediaTemplate EmbedCab="yes"/>
    <MajorUpgrade AllowSameVersionUpgrades="no" DowngradeErrorMessage="!(loc.DowngradeErrorMsg)" />
    <Property Id="PREVIOUSVERSIONSINSTALLED" Secure="yes" />
    <Upgrade Id="$(var.ProductUpgradeCode)">
      <UpgradeVersion
         Minimum="1.0.0.0" Maximum="99.0.0.0"
         Property="PREVIOUSVERSIONSINSTALLED"
         IncludeMinimum="yes" IncludeMaximum="no" />
    </Upgrade>

    <InstallExecuteSequence>
      <Custom Action='DeleteUserData' Before='RemoveFiles' >(REMOVE~="ALL") AND (NOT UPGRADINGPRODUCTCODE)</Custom>
    </InstallExecuteSequence>

    <!--<WixVariable Id="WixUIDialogBmp" Value="$(var.ProjectDir)\Assets\Background.bmp"/>-->
    <!--<WixVariable Id="WixUIBannerBmp" Value="$(var.ProjectDir)\Assets\Banner.bmp"/>-->
    <WixVariable Id="WixUILicenseRtf" Value="$(var.ProjectDir)\Assets\License.rtf" />

    <!--Files, start menu, folders-->
    <Feature Id="DesktopFeature" Title="Desktop" Level="1">
      <ComponentGroupRef Id="DesktopComponentsGroup" />
      <ComponentGroupRef Id="DesktopAutoGeneratedComponentsGroup" />
    </Feature>
  </Product>
</Wix>
